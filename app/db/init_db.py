# app/db/init_db.py

# ----------------------------------------------------------------------
# このファイル全体の役割
# ----------------------------------------------------------------------
# このスクリプトは、データベース内にアプリケーションが必要とするテーブルを初期作成するために使用されます。
# `app/db/models.py`で定義されたすべてのSQLAlchemyモデル（テーブルの設計図）を読み込み、
# データベースエンジンに接続して、対応するテーブルを生成します。
# 新しい環境をセットアップする際に一度だけ実行することを想定しています。
# ----------------------------------------------------------------------

import logging

# --- 内部モジュールのインポート ---
# `Base`は、すべてのDBモデルクラスが継承している基本クラスです。
# `metadata`は、定義されたすべてのテーブルに関する情報を保持しています。
from app.db.models import Base

# `engine`は、データベースへの接続を管理するコアなインターフェースです。
from app.db.session import engine

# ログ設定
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

def init_db() -> None:
    """
    データベース内のテーブルを初期化（作成）します。
    """
    logger.info("データベースのテーブルを作成しています... (存在しないテーブルのみ)")
    
    # `Base.metadata.create_all()` は、Baseを継承しているすべてのモデルクラスを検出し、
    # それに対応するテーブルがデータベースに存在しない場合にのみ、テーブルを作成します。
    # `bind=engine` は、どのデータベースに対して操作を行うかを指定します。
    Base.metadata.create_all(bind=engine)
    
    logger.info("テーブルの作成が完了しました。")


if __name__ == "__main__":
    init_db()
